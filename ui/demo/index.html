<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        background: #fafafa;
      }
    </style>
  </head>
  <body>
    <!-- TODO: change the element -->
    <where-demo-app></where-demo-app>


    <script type="module">
      import { ContextProvider } from '@lit-labs/context';
      import { WhereMap, WhereSpace, whereContext, WhereService, WhereStore  } from "../dist"
      import {
        ProfilePrompt,
        createProfilesStore,
        profilesStoreContext,
      } from "@holochain-open-dev/profiles";
      import { AppWebsocket } from "@holochain/conductor-api";
      import { HolochainClient } from "@holochain-open-dev/cell-client";
      import { ScopedElementsMixin } from '@open-wc/scoped-elements';
      import { LitElement, html } from 'lit';

      class WhereDemoApp extends ScopedElementsMixin(LitElement) {
        static get properties() {
          return {
            loaded: {
              type: Boolean,
            },
          };
        }

        async firstUpdated() {
          const appWebsocket = await AppWebsocket.connect(
            'ws://localhost:8888'
          );
          const appInfo = await appWebsocket.appInfo({
            installed_app_id: 'test-app',
          });

          const cellData = appInfo.cell_data[0];
          const cellClient = new HolochainClient(appWebsocket, cellData);

          const whereService = new WhereService(cellClient);
          const whereStore = new WhereStore(whereService);

          new ContextProvider(
            this,
            profilesStoreContext,
            createProfilesStore(cellClient)
          );

          new ContextProvider(
            this,
            whereContext,
            whereStore
          );

          this.loaded = true;
        }

        render() {
          if (!this.loaded) return html`<span>Loading...</span>`;
          return html`
            <profile-prompt style="height: 400px; width: 500px">
              <where-map></where-map>
            </profile-prompt>
          `;
        }

        static get scopedElements() {
          return {
            'profile-prompt': ProfilePrompt,
            'where-map': WhereMap,
            'where-space': WhereSpace
          };
        }
      }
      customElements.define('where-demo-app', WhereDemoApp);

    </script>
  </body>
</html>
