<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        background: #fafafa;
      }
    </style>
  </head>
  <body>
    <!-- TODO: change the element -->
    <context-provider id="profile_provider">
      <context-provider id="where_provider">
        <profile-prompt style="height: 400px; width: 500px">
          <where-map></where-map>
        </profile-prompt>
      </context-provider>
    </context-provider>

    <script type="module">
      import { ContextProviderElement } from "@holochain-open-dev/context";
      import { WhereMap, WhereSpace, WHERE_CONTEXT, WhereService, WhereStore  } from "../dist"
      import {
        ProfilePrompt,
        ProfilesStore,
        ProfilesService,
        PROFILES_STORE_CONTEXT,
      } from "@holochain-open-dev/profiles";
      import { AppWebsocket } from "@holochain/conductor-api";
      import { HolochainClient } from "@holochain-open-dev/cell-client";

      async function setup() {
        const appWebsocket = await AppWebsocket.connect(
          "ws://localhost:8888",
          //  process.env.CONDUCTOR_URL,
          12000
        );
        const appInfo = await appWebsocket.appInfo({
          installed_app_id: "test-app",
        });

        const cellData = appInfo.cell_data[0];

        const cellClient = new HolochainClient(appWebsocket, cellData);

        const profilesService = new ProfilesService(cellClient);
        const profilesStore = new ProfilesStore(profilesService);

        customElements.define("context-provider", ContextProviderElement);

        const provider = document.getElementById("profile_provider");
        provider.name = PROFILES_STORE_CONTEXT;
        provider.value = profilesStore;
        customElements.define("profile-prompt", ProfilePrompt);

        const whereService = new WhereService(cellClient);
        const whereStore = new WhereStore(whereService);
        const where_provider = document.getElementById("where_provider");
        where_provider.name = WHERE_CONTEXT;
        where_provider.value = whereStore;
        customElements.define("where-map", WhereMap);
        customElements.define("where-space", WhereSpace);

      }
      setup()
    </script>
  </body>
</html>
